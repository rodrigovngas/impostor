<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content" />
<title>El Impostor</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
    /* ----------------------------------------------------
       VARIABLES & TEMAS
    ---------------------------------------------------- */
    :root {
        --bg-color: #f8fafc;
        --card-bg: #ffffff;
        --card-border: #e2e8f0;
        --card-shadow: 0 20px 40px -10px rgba(148, 163, 184, 0.15);
        
        --text-main: #0f172a; 
        --text-muted: #64748b;
        
        --input-bg: #f1f5f9;
        --input-border: transparent;
        
        --item-bg: #ffffff;
        --item-border: #f1f5f9;

        /* MODO CLARO (#00ABE4) */
        --accent: #00ABE4; 
        --accent-soft: rgba(0, 171, 228, 0.08);
        --accent-glow: rgba(0, 171, 228, 0.4);
        
        --danger: #ef4444;
        --danger-soft: rgba(239, 68, 68, 0.1);
        --danger-glow: rgba(239, 68, 68, 0.4);
        
        --dot-color: #cbd5e1;
    }

    html.dark {
        --bg-color: #020617; 
        --card-bg: #0f172a;
        --card-border: #1e293b;
        --card-shadow: 0 20px 40px -10px rgba(0,0,0,0.6);
        
        --text-main: #f8fafc; 
        --text-muted: #94a3b8;
        
        --input-bg: #1e293b;
        --input-border: transparent;
        
        --item-bg: #1e293b;
        --item-border: #334155;

        /* MODO OSCURO (#2272FF) */
        --accent: #3b82f6; 
        --accent-soft: rgba(59, 130, 246, 0.15);
        --accent-glow: rgba(59, 130, 246, 0.5);
        
        --dot-color: #1e293b;
    }

    * { -webkit-tap-highlight-color: transparent; }

    /* ----------------------------------------------------
       FIX AGRESIVO PARA SCROLLBAR (SAFARI/CHROME)
    ---------------------------------------------------- */
    html::-webkit-scrollbar, 
    body::-webkit-scrollbar, 
    .app::-webkit-scrollbar, 
    ul::-webkit-scrollbar,
    *::-webkit-scrollbar { 
        display: none; 
        width: 0 !important;
        height: 0 !important; 
        background: transparent !important; 
        -webkit-appearance: none !important; 
    }
    
    html, body, .app, ul {
        scrollbar-width: none;  
        -ms-overflow-style: none;  
    }

    /* ----------------------------------------------------
       LAYOUT
    ---------------------------------------------------- */
    html, body {
        height: 100dvh;
        width: 100vw;
        margin: 0;
        font-family: 'Outfit', sans-serif;
        background-color: var(--bg-color);
        background-image: radial-gradient(var(--dot-color) 1.5px, transparent 1.5px);
        background-size: 32px 32px;
        color: var(--text-main);
        
        overflow-x: hidden; 
        overflow-y: auto; 
        overscroll-behavior-y: none; 
        
        transition: all 0.4s ease;
    }

    .app {
        max-width: 440px;
        width: 100%;
        min-height: 100dvh; 
        margin: 0 auto;
        padding: 20px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
    }

    .spacer { flex: 1; }

    /* --- HEADER --- */
    header { 
        display: flex; 
        align-items: center; 
        justify-content: space-between; 
        margin-top: 10px;
        margin-bottom: 20px;
        flex-shrink: 0; 
    }
    
    .logo-area h1 { 
        font-size: 26px; 
        font-weight: 800;
        margin: 0; 
        color: var(--text-main);
        letter-spacing: -0.03em;
        line-height: 1;
    }

    .logo-area .sub { 
        color: var(--text-muted); 
        font-size: 13px; 
        font-weight: 500;
        margin-top: 4px;
        letter-spacing: 0.05em;
    }

    .status-dot {
        width: 8px;
        height: 8px;
        background-color: var(--accent);
        border-radius: 50%;
        display: inline-block;
        margin-left: 6px;
        box-shadow: 0 0 10px var(--accent);
        animation: breath 2s infinite;
    }
    @keyframes breath { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(0.8); } }

    /* --- ANIMACIÓN ICONO --- */
    .dark-toggle {
        cursor: pointer;
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        width: 48px;
        height: 48px;
        border-radius: 16px;
        position: relative;
        color: var(--text-main);
        overflow: hidden;
        transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
        box-shadow: var(--card-shadow);
    }
    .dark-toggle:hover { transform: scale(1.05); }
    .dark-toggle:active { transform: scale(0.95); }

    .dark-toggle svg {
        width: 22px;
        height: 22px;
        stroke-width: 2px;
        stroke-linecap: round;
        stroke-linejoin: round;
        fill: none;
        stroke: currentColor;
        position: absolute;
        top: 50%;
        left: 50%;
        transition: all 0.5s cubic-bezier(0.4, 0.0, 0.2, 1);
    }

    .icon-moon { opacity: 1; transform: translate(-50%, -50%) rotate(0deg) scale(1); }
    .icon-sun { opacity: 0; transform: translate(-50%, -50%) rotate(90deg) scale(0.5); }
    html.dark .icon-moon { opacity: 0; transform: translate(-50%, -50%) rotate(-90deg) scale(0.5); }
    html.dark .icon-sun { opacity: 1; transform: translate(-50%, -50%) rotate(0deg) scale(1); }


    /* --- TARJETAS --- */
    .card {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 28px;
        padding: 24px;
        box-shadow: var(--card-shadow);
        margin-bottom: 16px;
        height: auto; 
        overflow: visible;
        animation: slideUpFade 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        backdrop-filter: blur(20px);
    }

    @keyframes slideUpFade {
        from { opacity: 0; transform: translateY(20px) scale(0.98); }
        to { opacity: 1; transform: translateY(0) scale(1); }
    }

    label { display: block; font-size: 13px; font-weight: 600; color: var(--text-muted); margin-bottom: 10px; padding-left: 4px; text-transform: uppercase; letter-spacing: 0.5px; }

    input, select {
        width: 100%;
        padding: 16px 20px;
        border-radius: 18px;
        border: 2px solid transparent; 
        background: var(--input-bg);
        color: var(--text-main);
        font-size: 16px; 
        font-family: 'Outfit', sans-serif;
        font-weight: 500;
        box-sizing: border-box;
        outline: none;
        transition: all 0.2s ease;
    }
    input:focus, select:focus {
        background: var(--card-bg);
        border-color: var(--accent);
        box-shadow: 0 4px 20px var(--accent-soft);
    }
    
    ::placeholder { color: var(--text-muted); opacity: 0.6; }

    /* --- BOTONES --- */
    button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 16px 24px;
        border-radius: 18px;
        background: transparent;
        border: 2px solid var(--accent);
        color: var(--accent);
        font-weight: 700;
        font-family: 'Outfit', sans-serif;
        font-size: 15px;
        cursor: pointer;
        letter-spacing: 0.02em;
        transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
        box-shadow: 0 4px 15px var(--accent-soft);
        min-height: 56px; 
        box-sizing: border-box;
    }
    
    button:active { transform: scale(0.96); }
    
    button:hover {
        background: var(--accent-soft);
        box-shadow: 0 8px 25px var(--accent-soft);
    }

    button.ghost {
        border-color: var(--card-border);
        color: var(--text-muted);
        box-shadow: none;
    }
    button.ghost:hover {
        border-color: var(--text-muted);
        color: var(--text-main);
        background: var(--input-bg);
    }
    
    button.danger {
        border-color: var(--danger);
        color: var(--danger);
        box-shadow: 0 4px 15px var(--danger-soft);
    }
    button.danger:hover {
        background: var(--danger-soft);
        box-shadow: 0 8px 25px var(--danger-soft);
    }

    button.dark-toggle {
        border: 1px solid var(--card-border);
        padding: 0;
        background: var(--card-bg);
        box-shadow: var(--card-shadow);
        color: var(--text-main);
        min-height: 44px;
    }

    .hold-btn {
        width: 100%;
        padding: 40px 20px;
        border: 2px dashed var(--accent);
        background: var(--accent-soft);
        color: var(--accent);
        font-size: 16px;
        text-transform: uppercase;
        letter-spacing: 1px;
        box-shadow: none;
        display: flex;
    }
    .hold-btn:active {
        background: var(--accent);
        color: white;
        border-style: solid;
        transform: scale(0.98);
    }

    .row { display: flex; gap: 10px; }
    
    .smallbtn { 
        padding: 0; 
        width: 54px;
        height: 54px;
        font-size: 26px; 
        border-radius: 18px;
        flex-shrink: 0;
        min-height: 54px;
    }

    ul { 
        padding: 0; 
        margin: 10px 0 0 0; 
        list-style: none; 
    }
    
    li { 
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--item-bg);
        border: 1px solid var(--item-border);
        padding: 14px 18px;
        border-radius: 16px;
        font-size: 16px;
        font-weight: 500;
        animation: slideInLeft 0.3s ease;
    }

    @keyframes slideInLeft {
        from { opacity: 0; transform: translateX(-10px); }
        to { opacity: 1; transform: translateX(0); }
    }

    .actions { display: flex; align-items: center; gap: 4px; }

    .btn-icon {
        border: none;
        background: transparent;
        padding: 8px;
        border-radius: 12px;
        color: var(--text-muted);
        box-shadow: none;
        width: auto; height: auto;
        min-height: auto;
    }
    .btn-icon:hover { background: var(--input-bg); color: var(--text-main); }
    .btn-delete:hover { background: var(--danger-soft); color: var(--danger); }
    .btn-edit:hover { color: var(--accent); background: transparent; }

    /* NOMBRE JUGADOR (SIN PULSACION) */
    .assign-name { 
        font-size: 42px; 
        font-weight: 900; 
        color: var(--text-main);
        text-align: center;
        margin: 30px 0;
        line-height: 1;
        letter-spacing: -1.5px;
    }
    
    /* CAJA DE REVELAR (CON PULSACION) */
    .reveal {
        margin-top: 0; 
        padding: 40px 24px;
        border-radius: 24px;
        
        background: var(--accent-soft);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        
        border: 2px solid var(--accent);
        
        text-align: center;
        display: none;
        min-height: 120px;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        
        animation: boxPulse 2s infinite;
        
        width: 100%;
        box-sizing: border-box;
    }

    @keyframes boxPulse {
        0% { transform: scale(1); box-shadow: 0 0 0 0 var(--accent-soft); }
        50% { transform: scale(1.02); box-shadow: 0 0 20px var(--accent-soft); }
        100% { transform: scale(1); box-shadow: 0 0 0 0 var(--accent-soft); }
    }

    .reveal-title { font-size: 14px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; font-weight: 600; }
    .reveal-word { font-size: 32px; font-weight: 800; color: var(--text-main); }

    /* IMPOSTOR MODE */
    .reveal.impostor-mode {
        background: var(--danger-soft);
        border-color: var(--danger);
        animation: dangerPulse 1.5s infinite;
    }
    
    .reveal-impostor-text {
        font-size: 36px;
        font-weight: 900;
        color: var(--danger); 
        letter-spacing: -1px;
        text-shadow: 0 4px 20px var(--danger-glow);
    }

    @keyframes dangerPulse {
        0% { box-shadow: 0 0 0 0 var(--danger-soft); transform: scale(1); }
        50% { transform: scale(1.02); }
        100% { box-shadow: 0 0 0 15px transparent; transform: scale(1); }
    }

    /* TIMER */
    .timer-wrap { display: flex; flex-direction: column; gap: 12px; align-items: center; margin: 20px 0; }
    .timer-number { font-size: 72px; font-weight: 900; color: var(--text-main); font-variant-numeric: tabular-nums; line-height: 1; }
    
    .bar-outer { width: 100%; height: 12px; background: var(--input-bg); border-radius: 99px; overflow: hidden; }
    .bar-inner { 
        height: 100%; width: 100%; 
        background: linear-gradient(90deg, var(--danger) 0%, var(--accent) 100%);
        border-radius: 99px;
        transition: width 0.1s linear; 
    }

    .controls { 
        display: flex; 
        gap: 12px; 
        flex-wrap: wrap; 
        margin-top: 10px; 
        align-items: stretch; 
    }

    /* VOTACION */
    .vote-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px; }

    .vote-card {
        background: var(--item-bg);
        border: 2px solid var(--item-border);
        border-radius: 20px;
        padding: 24px 10px;
        text-align: center;
        color: var(--text-main);
        font-weight: 700;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 80px;
    }
    
    .vote-card:active { transform: scale(0.95); }

    .vote-card.voted {
        background: var(--accent-soft);
        color: var(--accent); 
        border-color: var(--accent);
        transform: scale(1.02);
        box-shadow: 0 10px 25px var(--accent-soft);
    }

    .vote-grid.has-selection .vote-card:not(.voted) { opacity: 0.4; transform: scale(0.95); filter: grayscale(1); }

    /* RESULTADO */
    .result-text { font-size: 24px; font-weight: 800; color: var(--text-main); margin: 10px 0; line-height: 1.3; }
    
    .footer {
        text-align: center;
        margin-top: auto;
        padding: 20px 0;
        color: var(--text-muted);
        font-size: 12px;
        font-weight: 500;
        opacity: 0.7;
    }

</style>
</head>
<body>
<div class="app">

    <header>
        <div class="logo-area">
            <h1>El Impostor<span class="status-dot"></span></h1>
            <div class="sub">TRAKAS HDSPM</div>
        </div>
        
        <button class="dark-toggle" onclick="toggleDarkMode()" title="Cambiar tema">
            <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
            <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
        </button>
    </header>

    <div id="admin" class="card">
        <label>Añadir palabra</label>
        <div class="row">
            <input type="text" id="nuevaPalabra" placeholder="Ej. Cybertruck, Zumpango..." />
            <button class="smallbtn" onclick="agregarPalabra()">+</button>
        </div>

        <ul id="listaPalabras"></ul>

        <hr style="margin:24px 0; border:none; border-top:1px solid var(--card-border)" />

        <label>Añadir jugador</label>
        <div class="row">
            <input type="text" id="nombreJugador" placeholder="Nombre del jugador" />
            <button class="smallbtn" onclick="agregarJugador()">+</button>
        </div>

        <ul id="listaJugadores"></ul>

        <div style="margin-top:24px" class="row">
            <div style="flex:1">
                <label>Tiempo ronda</label>
                <select id="duracionSelect">
                    <option value="60" selected>1 minuto</option>
                    <option value="120">2 minutos</option>
                    <option value="180">3 minutos</option>
                    <option value="240">4 minutos</option>
                    <option value="300">5 minutos</option>
                </select>
            </div>
            <div style="align-self:flex-end">
                <button style="width:100%" onclick="iniciarJuego()">¡Jugar!</button>
            </div>
        </div>

        <div style="margin-top:16px" class="row">
            <button class="danger ghost" style="flex:1" onclick="reiniciarTodo()">Reset Total</button>
        </div>
    </div>

    <div id="asignacion" class="card" style="display:none">
        <div style="display:flex; justify-content:space-between; align-items:center; opacity:0.6;">
            <div style="font-size:12px; font-weight:700; text-transform:uppercase; letter-spacing:1px;">Turno de</div>
            <div style="font-size:14px; font-variant-numeric: tabular-nums;">
                <span id="indiceAsignacion">1</span> / <span id="totalAsignacion">1</span>
            </div>
        </div>

        <div class="assign-name" id="nombreJugadorAsignacion">Jugador</div>

        <div style="display:flex; gap:16px; flex-direction:column; margin-top:10px;">
            <div style="position:relative; width:100%">
                <button id="btnReveal" class="hold-btn" oncontextmenu="return false;">
                    MANTÉN PARA VER TU ROL
                </button>
                <div id="textoPalabra" class="reveal"></div>
            </div>

            <button onclick="siguienteJugador()" style="margin-top:8px; width:100%">Entendido, siguiente</button>
        </div>
    </div>

    <div id="pistas" class="card" style="display:none">
        <div style="display:flex; justify-content:space-between; align-items:center">
            <div>
                <div style="font-size:12px; color:var(--text-muted); font-weight:600; text-transform:uppercase">Fase de debate</div>
                <div style="font-weight:800; font-size:18px; color:var(--text-main)">Describan la palabra</div>
            </div>
        </div>

        <div class="timer-wrap">
            <div class="timer-number" id="timerNumber">60</div>
            <div class="bar-outer"><div id="timerBar" class="bar-inner"></div></div>
        </div>

        <div class="controls">
            <button id="botonIniciarTimer" style="flex:1.5" onclick="iniciarTemporizador()">
                <svg viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg> Iniciar
            </button>
            <button class="ghost" style="flex:1" onclick="saltarAPuesta()">Votación</button>
        </div>
    </div>

    <div id="votacion" class="card" style="display:none">
        <div style="text-align:center; margin-bottom:16px;">
            <div style="font-size:12px; color:var(--text-muted); font-weight:700; text-transform:uppercase">Votación final</div>
            <div style="font-weight:900; font-size:20px; color:var(--text-main)">¿Quién es el impostor?</div>
        </div>

        <div id="voteContainer" class="vote-grid"></div>

        <button style="margin-top:20px; width:100%" class="ghost" onclick="mostrarResultado()">
            Ver Resultados
        </button>
    </div>

    <div id="resultado" class="card" style="display:none">
        <div style="text-align:center">
            <div style="font-size:12px; color:var(--text-muted); font-weight:700; text-transform:uppercase">Resultado</div>
            <div class="result-text" id="textoResultado"></div>
        </div>

        <div id="impostorGuessSection" style="margin-top:24px; padding:20px; border:1px solid var(--danger); border-radius:24px; background:var(--danger-soft); display:none">
            <label id="impostorGuessLabel" style="color:var(--danger); font-weight:800; font-size:18px; text-align:center; display:block; margin-bottom:8px"></label>
            <p style="font-size:14px; text-align:center; margin-bottom:16px; color:var(--text-main); opacity:0.8;">Si adivinas la palabra, ganas la partida.</p>
            
            <div style="display:flex; gap:8px">
                <input type="text" id="guessInput" placeholder="Palabra secreta..." style="background:var(--card-bg)" />
            </div>
            <button class="danger" style="width:100%; margin-top:12px;" onclick="impostorAdivina()">Intentar Adivinar</button>
            
            <div id="guessFeedback" style="margin-top:12px; font-weight:700; font-size:15px; text-align:center"></div>
        </div>

        <div style="margin-top:30px; display:flex; flex-direction:column; gap:12px;">
            <button onclick="nuevaRonda()">Jugar otra vez</button>
            <button class="ghost" onclick="mostrarSeccion('admin')">Volver al menú</button>
        </div>
    </div>
    
    <div class="spacer"></div>

    <footer class="footer">
        Development by VNGAS
    </footer>

</div>

<script>
    /* LÓGICA DE ESCRITURA EN EL TÍTULO */
    const titleElement = document.querySelector('h1');
    const textToType = "El Impostor";
    let charIndex = 0;

    function typeWriter() {
        if (charIndex < textToType.length) {
            let currentText = titleElement.childNodes[0].nodeValue || "";
            titleElement.childNodes[0].nodeValue = currentText + textToType.charAt(charIndex);
            charIndex++;
            setTimeout(typeWriter, 120);
        } else {
            setTimeout(() => {
                titleElement.childNodes[0].nodeValue = "";
                charIndex = 0;
                typeWriter();
            }, 10000); 
        }
    }
    titleElement.innerHTML = '<span class="status-dot"></span>'; 
    titleElement.insertBefore(document.createTextNode(""), titleElement.firstChild);
    setTimeout(typeWriter, 300);


    /* --- LÓGICA DEL JUEGO --- */
    let palabras = [];
    let jugadores = [];
    let jugadoresMezclados = [];
    let impostor = null;
    let palabraSeleccionada = "";
    let indiceActual = 0;
    let votos = {};
    let duracion = 60; 
    let timer = null;
    let tiempoRestante = 0;
    let timerRunning = false;

    const SVG_PLAY = '<svg viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>';
    const SVG_PAUSE = '<svg viewBox="0 0 24 24"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>';

    /* Auto Dark Mode detection */
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.classList.add('dark');
    }

    function toggleDarkMode(){
        document.documentElement.classList.toggle('dark');
    }

    function mostrarSeccion(id) {
        const secciones = ['admin','asignacion','pistas','votacion','resultado'];
        secciones.forEach(s => {
            const el = document.getElementById(s);
            if(s === id) {
                el.style.display = 'block';
                el.style.animation = 'none';
                el.offsetHeight; 
                el.style.animation = null; 
            } else {
                el.style.display = 'none';
            }
        });
    }

    /* GESTIÓN DE PALABRAS Y JUGADORES */
    function agregarPalabra(){
        const input = document.getElementById('nuevaPalabra');
        const p = input.value.trim();
        if(!p) return;
        palabras.push(p);
        renderPalabras();
        input.value = '';
        input.focus();
    }

    function eliminarPalabra(index){
        palabras.splice(index, 1);
        renderPalabras();
    }

    function renderPalabras(){
        const ul = document.getElementById('listaPalabras');
        ul.innerHTML = '';
        if(palabras.length === 0) {
            ul.innerHTML = '<li style="justify-content:center; color:var(--text-muted); font-style:italic; background:transparent; border:none">No hay palabras</li>';
        }
        palabras.forEach((p, index) => {
            const li = document.createElement('li');
            li.innerHTML = `
                <span>${p}</span>
                <button class="btn-icon btn-delete" onclick="eliminarPalabra(${index})">&times;</button>
            `;
            ul.appendChild(li);
        });
    }

    function agregarJugador(){
        const input = document.getElementById('nombreJugador');
        const name = input.value.trim();
        if(!name) return;
        jugadores.push(name);
        renderJugadores();
        input.value = '';
        input.focus();
    }

    function eliminarJugador(index){
        jugadores.splice(index, 1);
        renderJugadores();
    }

    function renderJugadores(){
        const ul = document.getElementById('listaJugadores');
        ul.innerHTML = '';
        if(jugadores.length === 0) {
            ul.innerHTML = '<li style="justify-content:center; color:var(--text-muted); font-style:italic; background:transparent; border:none">No hay jugadores</li>';
        }
        jugadores.forEach((j, index) => {
            const li = document.createElement('li');
            li.innerHTML = `
                <span>${j}</span>
                <button class="btn-icon btn-delete" onclick="eliminarJugador(${index})">&times;</button>
            `;
            ul.appendChild(li);
        });
    }

    function reiniciarTodo(){
        if(!confirm('¿Borrar todo?')) return;
        palabras = [];
        jugadores = [];
        resetGameData();
        renderPalabras();
        renderJugadores();
        mostrarSeccion('admin');
    }

    function resetGameData() {
        jugadoresMezclados = [];
        impostor = null;
        palabraSeleccionada = '';
        votos = {};
        stopTemporizador();
    }

    /* FLUJO DEL JUEGO */
    function iniciarJuego(){
        if(jugadores.length < 3){
            alert('Se requieren mínimo 3 jugadores.'); return;
        }
        if(palabras.length === 0){
            alert('Faltan palabras.'); return;
        }

        duracion = Number(document.getElementById('duracionSelect').value || 60);
        
        const label = document.getElementById('duracionLabel');
        if(label) label.innerText = duracion + 's';

        nuevaRonda();
    }

    function nuevaRonda(){
        votos = {};
        document.getElementById('guessFeedback').innerText = '';
        document.getElementById('guessInput').value = '';
        document.getElementById('impostorGuessSection').style.display = 'none';

        palabraSeleccionada = palabras[Math.floor(Math.random()*palabras.length)];
        jugadoresMezclados = [...jugadores].sort(()=>Math.random()-0.5);
        impostor = jugadoresMezclados[Math.floor(Math.random()*jugadoresMezclados.length)];

        indiceActual = 0;
        document.getElementById('totalAsignacion').innerText = jugadoresMezclados.length;
        
        cargarJugador();
        mostrarSeccion('asignacion');

        stopTemporizador();
        tiempoRestante = duracion;
        actualizarTimerUI(duracion);
    }

    function cargarJugador(){
        const jugador = jugadoresMezclados[indiceActual];
        document.getElementById('nombreJugadorAsignacion').innerText = jugador;
        document.getElementById('indiceAsignacion').innerText = (indiceActual+1);
        
        const elem = document.getElementById('textoPalabra');
        elem.style.display = 'none';
        elem.className = 'reveal'; 
        
        const btn = document.getElementById('btnReveal');
        btn.style.display = 'flex';
        btn.style.opacity = '1';
    }

    function siguienteJugador(){
        document.getElementById('textoPalabra').style.display = 'none';
        
        indiceActual++;
        if(indiceActual >= jugadoresMezclados.length){
            document.getElementById('botonIniciarTimer').innerHTML = SVG_PLAY + " Iniciar";
            prepararVotacion();
            mostrarSeccion('pistas');
            return;
        }
        cargarJugador();
    }

    /* REVELAR ROL */
    const btnReveal = document.getElementById('btnReveal');
    const revealBox = document.getElementById('textoPalabra');

    function showContent(){
        const jugador = jugadoresMezclados[indiceActual];
        if(jugador === impostor){
            revealBox.className = 'reveal impostor-mode'; 
            revealBox.innerHTML = `
                <div class="reveal-title">Tu misión</div>
                <div class="reveal-impostor-text">IMPOSTOR</div>
                <div style="font-size:13px; margin-top:8px; opacity:0.8; color:var(--danger)">Engaña a todos</div>
            `;
        } else {
            revealBox.className = 'reveal'; 
            revealBox.innerHTML = `
                <div class="reveal-title">La palabra es</div>
                <div class="reveal-word">${palabraSeleccionada}</div>
            `;
        }
        
        btnReveal.style.display = 'none'; 
        revealBox.style.display = 'flex';
    }

    function hideContent(){
        revealBox.style.display = 'none';
        btnReveal.style.display = 'flex';
    }

    // Eventos Mouse/Touch
    btnReveal.addEventListener('mousedown', showContent);
    btnReveal.addEventListener('mouseup', hideContent);
    btnReveal.addEventListener('mouseleave', hideContent);
    btnReveal.addEventListener('touchstart', (e) => { e.preventDefault(); showContent(); });
    btnReveal.addEventListener('touchend', hideContent);

    /* TEMPORIZADOR */
    function iniciarTemporizador(){
        const btn = document.getElementById('botonIniciarTimer');
        
        if(timerRunning) {
            stopTemporizador();
            btn.innerHTML = SVG_PLAY + " Reanudar";
            return;
        }
        
        if(tiempoRestante <= 0 && !timer) tiempoRestante = duracion;
        
        actualizarTimerUI(tiempoRestante);
        btn.innerHTML = SVG_PAUSE + " Pausar";
        timerRunning = true;

        timer = setInterval(()=> {
            tiempoRestante -= 0.1; 
            if(tiempoRestante <= 0){
                tiempoRestante = 0;
                actualizarTimerUI(0);
                stopTemporizador();
                if(navigator.vibrate) navigator.vibrate([200, 100, 200]);
                alert("¡Tiempo terminado!");
                saltarAPuesta();
            } else {
                actualizarTimerUI(tiempoRestante);
            }
        }, 100);
    }

    function stopTemporizador(){
        if(timer) clearInterval(timer);
        timer = null;
        timerRunning = false;
    }

    function actualizarTimerUI(segundos){
        document.getElementById('timerNumber').innerText = Math.ceil(segundos);
        const pct = Math.max(0, Math.min(1, segundos / duracion));
        document.getElementById('timerBar').style.width = (pct*100) + '%';
    }

    function saltarAPuesta(){
        stopTemporizador();
        prepararVotacion();
        mostrarSeccion('votacion');
    }

    /* VOTACION */
    function prepararVotacion(){
        const container = document.getElementById('voteContainer');
        container.innerHTML = ''; 
        container.classList.remove('has-selection'); 
        votos = {}; 
        
        jugadores.forEach(jugador => {
            const btn = document.createElement('button');
            btn.className = 'vote-card';
            btn.innerText = jugador;
            btn.dataset.originalName = jugador;
            
            btn.onclick = function() { registrarVotoUnico(jugador, btn); };
            container.appendChild(btn);
        });
    }

    function registrarVotoUnico(elegido, btnElement){
        votos = {}; 
        votos[elegido] = 1;

        const container = document.getElementById('voteContainer');
        container.classList.add('has-selection'); 

        const allBtns = container.querySelectorAll('.vote-card');
        allBtns.forEach(b => {
            b.classList.remove('voted');
            b.innerText = b.dataset.originalName; 
        });

        btnElement.classList.add('voted');
        btnElement.innerText = "Eliminar a\n" + elegido; 
        if(navigator.vibrate) navigator.vibrate(50);
    }

    /* RESULTADO */
    function mostrarResultado(){
        let masVotado = null;
        let max = -1;
        for(const k in votos){
            if(votos[k] > max){ max = votos[k]; masVotado = k; }
        }

        const res = document.getElementById('textoResultado');
        const guessSection = document.getElementById('impostorGuessSection');
        
        if(!masVotado){
            res.innerHTML = `Nadie fue expulsado.<br>El impostor era <span style="color:var(--danger)">${impostor}</span>.
            <div style="margin-top:12px; font-size:18px; color:var(--text-muted)">La palabra era <strong style="color:var(--text-main)">${palabraSeleccionada}</strong></div>`;
            guessSection.style.display = 'none';
        } 
        else if(masVotado === impostor){
            res.innerHTML = `¡Atraparon al Impostor! era <strong>${impostor}</strong>.
            <div style="margin-top:12px; font-size:18px; color:var(--text-muted)">La palabra era <strong style="color:var(--text-main)">${palabraSeleccionada}</strong></div>`;
            guessSection.style.display = 'none';
        } 
        else {
            res.innerHTML = `Se equivocaron.<br>El impostor era <strong style="color:var(--danger)">${impostor}</strong>.`;
            document.getElementById('impostorGuessLabel').innerText = `¡No te me emociones ${impostor}!`;
            guessSection.style.display = 'block';
        }
        
        mostrarSeccion('resultado');
    }

    function impostorAdivina(){
        const intento = document.getElementById('guessInput').value.trim();
        const feed = document.getElementById('guessFeedback');
        
        if(!intento){ feed.innerText = 'Escribe algo primero.'; return; }
        
        if(intento.toLowerCase() === palabraSeleccionada.toLowerCase()){
            feed.style.color = '#10b981';
            feed.innerText = '¡INCREÍBLE! Ganaste.';
        } else {
            feed.style.color = 'var(--danger)';
            feed.innerText = `Nop. Era "${palabraSeleccionada}".`;
        }
    }

    /* TECLADO */
    document.addEventListener('keydown', e => {
        if(e.key === 'Enter'){
            const f = document.activeElement;
            if(f.id === 'nuevaPalabra') agregarPalabra();
            if(f.id === 'nombreJugador') agregarJugador();
            if(f.id === 'guessInput') impostorAdivina();
        }
    });

    mostrarSeccion('admin');
    renderPalabras();
    renderJugadores();

</script>
</body>
</html>