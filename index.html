<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, interactive-widget=resizes-content" />
<title>El Impostor</title>
<style>
    /* ----------------------------------------------------
       SISTEMA DE DISE√ëO (VARIABLES)
    ---------------------------------------------------- */
    :root {
        --bg-gradient: linear-gradient(180deg, #eef3ff 0%, #f6fbff 100%);
        --card-bg: #ffffff;
        --card-border: #e6e9ef;
        --card-shadow: 0 6px 18px rgba(17,24,39,0.06);
        
        --text-main: #1f2937;
        --text-muted: #6b7280;
        
        --input-bg: #ffffff;
        --input-border: #e5e7eb;
        
        --item-bg: #fafbff;
        --item-border: #f0f2ff;

        /* COLORES */
        --accent: #9b5ce7;   /* Morado */
        --accent-2: #14ff00; /* Verde Fosfo */
        --danger: #ff6b6b;
    }

    html.dark {
        --bg-gradient: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
        --card-bg: #1e293b;
        --card-border: #334155;
        --card-shadow: 0 6px 18px rgba(0,0,0,0.4);
        
        --text-main: #f3f4f6;
        --text-muted: #9ca3af;
        
        --input-bg: #0f172a;
        --input-border: #374151;
        
        --item-bg: #1e293b;
        --item-border: #374151;
    }

    /* ----------------------------------------------------
       ESTILOS GENERALES Y LAYOUT FIJO
    ---------------------------------------------------- */
    html, body {
        height: 100dvh;
        width: 100vw;
        margin: 0;
        font-family: Inter, "Segoe UI", Roboto, sans-serif;
        background: var(--bg-gradient);
        color: var(--text-main);
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: color 0.3s ease, background 0.3s ease;
        -webkit-user-select: none;
        user-select: none;
        -webkit-text-size-adjust: 100%;
    }

    .app {
        max-width: 420px;
        width: 100%;
        height: 100%;
        margin: auto;
        padding: 16px;
        box-sizing: border-box;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }

    .spacer { flex: 1; }

    header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; flex-shrink: 0; }
    
    /* EFECTO M√ÅQUINA DE ESCRIBIR EN H1 */
    h1 { 
        font-size: 20px; 
        margin: 0; 
        color: var(--text-main);
        display: inline-flex;
        align-items: center;
        min-height: 24px;
    }

    h1::after {
        content: '';
        display: inline-block;
        width: 3px;
        height: 20px;
        background-color: var(--accent-2);
        margin-left: 2px;
        animation: blinkCursor 0.8s step-end infinite;
    }

    @keyframes blinkCursor {
        0%, 100% { opacity: 1; }
        50% { opacity: 0; }
    }

    .sub { color: var(--text-muted); font-size: 13px; margin-top: 4px; }

    .dark-toggle {
        margin-left: auto;
        cursor: pointer;
        background: none;
        border: none;
        font-size: 20px;
        padding: 8px;
        border-radius: 50%;
        transition: background 0.2s;
    }
    .dark-toggle:hover { background: rgba(128,128,128,0.1); }

    .card {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 18px;
        padding: 16px;
        box-shadow: var(--card-shadow);
        margin-bottom: 12px;
        overflow: hidden;
        transition: background 0.3s ease, border-color 0.3s ease;
        flex-shrink: 0;
    }

    label { display: block; font-size: 13px; color: var(--text-muted); margin-bottom: 6px; margin-left: 4px; }

    input, select {
        width: 100%;
        padding: 12px 20px;
        border-radius: 50px;
        border: 1px solid var(--input-border);
        background: var(--input-bg);
        color: var(--text-main);
        font-size: 16px; 
        box-sizing: border-box;
        outline: none;
        transition: border-color 0.2s;
        -webkit-user-select: text;
        user-select: text;
    }
    input:focus, select:focus {
        border-color: var(--accent-2);
    }

    /* --- BOTONES CON 15% MORADO --- */
    button {
        display: inline-block;
        padding: 12px 24px;
        border-radius: 50px;
        border: none;
        
        /* CAMBIO: El morado llega solo al 15% */
        background: linear-gradient(110deg, var(--accent) 0%, var(--accent) 15%, var(--accent-2) 100%);
        
        color: #000;
        font-weight: 700;
        cursor: pointer;
        
        /* Sombra con toque morado muy sutil */
        box-shadow: 0 4px 15px rgba(20, 255, 0, 0.4), 0 0 20px rgba(155, 92, 231, 0.15);
        
        transition: transform .12s ease, opacity .12s;
        font-size: 14px;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
    }
    button:active { transform: scale(0.97); }
    
    button.ghost {
        background: transparent;
        color: var(--accent-2);
        box-shadow: none;
        border: 2px solid var(--accent-2);
        opacity: 0.9;
    }
    html.dark button.ghost {
        color: var(--accent-2);
        border-color: var(--accent-2);
    }
    
    button.danger {
        background: linear-gradient(90deg, #ff8a8a, #ff6b6b);
        box-shadow: 0 4px 12px rgba(255,107,107,0.3);
        color: white;
    }

    .hold-btn {
        padding: 24px 20px;
        font-size: 16px;
        width: 100%;
        touch-action: manipulation;
    }

    .row { display: flex; gap: 8px; }
    
    .smallbtn { 
        padding: 0; 
        width: 44px;
        height: 44px;
        font-size: 22px; 
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        flex-shrink: 0;
        color: black;
    }

    /* ESTILOS DE LISTA (Items) */
    ul { 
        padding: 0; 
        margin: 8px 0 0 0; 
        color: var(--text-main); 
        list-style: none;
    }
    
    li { 
        margin-bottom: 6px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--item-bg);
        border: 1px solid var(--item-border);
        padding: 8px 12px;
        border-radius: 12px;
        font-size: 14px;
    }

    .actions { display: flex; align-items: center; gap: 2px; }

    .btn-icon {
        background: transparent;
        box-shadow: none;
        padding: 0;
        width: 32px;
        height: 32px;
        font-size: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        cursor: pointer;
    }
    
    .btn-delete { color: var(--danger); }
    .btn-delete:hover { background: rgba(255, 107, 107, 0.1); }

    .btn-edit { color: var(--accent); font-size: 16px; }
    .btn-edit:hover { background: rgba(155, 92, 231, 0.1); }

    .assign-name { font-size: 20px; font-weight: 700; color: var(--text-main); }
    
    .reveal {
        margin-top: 12px;
        padding: 24px 16px;
        border-radius: 16px;
        background: linear-gradient(180deg, #0a0a0a 0%, #000000 100%);
        border: 2px solid var(--accent);
        color: white;
        text-align: center;
        font-weight: 700;
        font-size: 22px;
        display: none;
        min-height: 80px;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        animation: fadeIn 0.2s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-5px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* --- EFECTO NE√ìN (85% Verde / 15% Morado) --- */
    .neon {
        color: var(--accent-2); 
        text-shadow:
            0 0 5px var(--accent-2),
            0 0 15px var(--accent-2),
            0 0 30px var(--accent-2), /* Tercera capa verde */
            0 0 60px rgba(155, 92, 231, 0.4); /* Morado sutil y transparente */
        
        animation: neonPulse 1.6s ease-in-out infinite;
    }

    @keyframes neonPulse {
        0% { 
            text-shadow: 
                0 0 5px var(--accent-2), 
                0 0 15px var(--accent-2),
                0 0 30px var(--accent-2),
                0 0 60px rgba(155, 92, 231, 0.3); 
            transform: scale(1); 
        }
        50% { 
            text-shadow: 
                0 0 5px var(--accent-2), 
                0 0 20px var(--accent-2),
                0 0 40px var(--accent-2),
                0 0 70px rgba(155, 92, 231, 0.5); /* Destello sutil morado */
            transform: scale(1.02); 
        }
        100% { 
            text-shadow: 
                0 0 5px var(--accent-2), 
                0 0 15px var(--accent-2),
                0 0 30px var(--accent-2),
                0 0 60px rgba(155, 92, 231, 0.3); 
            transform: scale(1); 
        }
    }

    .timer-wrap { display: flex; flex-direction: column; gap: 8px; align-items: center; }
    .timer-number { font-size: 48px; font-weight: 800; color: var(--text-main); }
    .bar-outer { width: 100%; height: 12px; background: var(--input-border); border-radius: 999px; overflow: hidden; }
    .bar-inner { height: 100%; width: 100%; background: linear-gradient(90deg, var(--accent) 0%, var(--accent-2) 30%, var(--accent-2) 100%); transition: width 0.2s linear; }

    .vote-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 16px;
        border-radius: 50px;
        background: var(--item-bg);
        border: 1px solid var(--item-border);
        color: var(--text-main);
        margin-bottom: 6px;
    }

    .result-text { font-size: 18px; font-weight: 700; color: var(--text-main); margin: 8px 0; }
    .controls { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }

    .footer {
        width: 100%;
        text-align: center;
        margin: 20px 0;
        color: var(--text-muted);
        font-size: 12px;
        flex-shrink: 0;
        padding-bottom: 10px;
    }

    @media (max-width: 420px){
        .timer-number { font-size: 44px; }
    }
</style>
</head>
<body>
<div class="app">

    <header>
        <div>
            <h1></h1> <div class="sub">TRAKAS HDSPM</div>
        </div>
        <button class="dark-toggle" onclick="toggleDarkMode()" title="Cambiar tema">üåó</button>
    </header>

    <div id="admin" class="card">
        <label>A√±adir palabra</label>
        <div class="row">
            <input type="text" id="nuevaPalabra" placeholder="ej. Manzana, Playa..." />
            <button class="smallbtn" onclick="agregarPalabra()">+</button>
        </div>

        <div style="margin-top:12px">
            <label>Palabras disponibles</label>
            <ul id="listaPalabras"></ul>
        </div>

        <hr style="margin:16px 0; border:none; border-top:1px solid var(--card-border)" />

        <label>A√±adir jugador</label>
        <div class="row">
            <input type="text" id="nombreJugador" placeholder="Nombre" />
            <button class="smallbtn" onclick="agregarJugador()">+</button>
        </div>

        <div style="margin-top:12px">
            <label>Jugadores</label>
            <ul id="listaJugadores"></ul>
        </div>

        <div style="margin-top:16px" class="row">
            <div style="flex:1">
                <label>Tiempo ronda</label>
                <select id="duracionSelect">
                    <option value="60" selected>1 minuto</option>
                    <option value="120">2 minutos</option>
                    <option value="180">3 minutos</option>
                    <option value="240">4 minutos</option>
                    <option value="300">5 minutos</option>
                    <option value="360">6 minutos</option>
                </select>
            </div>
            <div style="align-self:flex-end">
                <button onclick="iniciarJuego()">¬°Jugar!</button>
            </div>
        </div>

        <div style="margin-top:12px" class="row">
            <button class="danger" style="flex:1" onclick="reiniciarTodo()">Reset Total</button>
        </div>
    </div>

    <div id="asignacion" class="card" style="display:none">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <div>
                <div style="font-size:12px; color:var(--text-muted); text-transform:uppercase; letter-spacing:1px;">Turno de</div>
                <div class="assign-name" id="nombreJugadorAsignacion">Jugador</div>
            </div>
            <div style="text-align:right; color:var(--text-muted); font-size:14px; font-feature-settings:'tnum';">
                <span id="indiceAsignacion">1</span> / <span id="totalAsignacion">1</span>
            </div>
        </div>

        <div style="display:flex; gap:12px; flex-direction:column">
            <button id="btnReveal" class="hold-btn" oncontextmenu="return false;">
                üëÜ Mant√©n presionado para ver la palabra
            </button>
            
            <div id="textoPalabra" class="reveal"></div>

            <div style="display:flex; gap:8px">
                <button onclick="siguienteJugador()" style="flex:1">Entendido, siguiente</button>
            </div>
        </div>
    </div>

    <div id="pistas" class="card" style="display:none">
        <div style="display:flex; justify-content:space-between; align-items:center">
            <div>
                <div style="font-size:12px; color:var(--text-muted)">Go Go Go</div>
                <div style="font-weight:700; font-size:16px; color:var(--text-main)">Describan la palabra</div>
            </div>
            <div style="text-align:right">
                <div style="font-size:12px; color:var(--text-muted)">Tiempo</div>
                <div style="font-weight:700; color:var(--text-main)" id="duracionLabel"></div>
            </div>
        </div>

        <div style="margin-top:20px" class="timer-wrap">
            <div class="timer-number" id="timerNumber">60</div>
            <div class="bar-outer" aria-hidden="true">
                <div id="timerBar" class="bar-inner"></div>
            </div>
        </div>

        <div style="margin-top:20px" class="controls">
            <button id="botonIniciarTimer" style="flex:1" onclick="iniciarTemporizador()">‚ñ∂ Iniciar</button>
            <button class="ghost" onclick="saltarAPuesta()">Ir a votaci√≥n</button>
        </div>
    </div>

    <div id="votacion" class="card" style="display:none">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
            <div>
                <div style="font-size:12px; color:var(--text-muted)">Votaci√≥n</div>
                <div style="font-weight:700; font-size:16px; color:var(--text-main)">¬øQui√©n es el impostor?</div>
            </div>
        </div>

        <label>Selecciona al sospechoso:</label>
        <select id="voto" style="margin-bottom:10px"></select>

        <div class="row">
            <button onclick="registrarVoto()" style="flex:1">Votar</button>
        </div>

        <div style="margin-top:16px">
            <label>Votos registrados:</label>
            <div id="listaVotosContainer">
                <div style="font-size:13px; color:var(--text-muted); font-style:italic;" id="noVotosMsg">A√∫n nadie ha votado.</div>
                <ul id="listaVotos" style="list-style:none; padding:0; margin:0;"></ul>
            </div>
        </div>

        <button style="margin-top:16px; width:100%" class="ghost" onclick="mostrarResultado()">Finalizar votaci√≥n</button>
    </div>

    <div id="resultado" class="card" style="display:none">
        <div>
            <div style="font-size:12px; color:var(--text-muted)">Resultado final</div>
            <div class="result-text" id="textoResultado"></div>
        </div>

        <div id="impostorGuessSection" style="margin-top:16px; padding:12px; border:1px solid var(--danger); border-radius:18px; background:rgba(255,107,107,0.1); display:none">
            <label style="color:var(--danger); font-weight:700;">¬°Oportunidad del Impostor!</label>
            <p style="font-size:13px; margin:4px 0 8px 0; color:var(--text-main)">Si adivina la palabra, gana la partida.</p>
            <div class="row">
                <input type="text" id="guessInput" placeholder="¬øCu√°l era la palabra?" />
                <button class="danger" onclick="impostorAdivina()">Probar</button>
            </div>
            <div id="guessFeedback" style="margin-top:8px; font-weight:600; font-size:14px;"></div>
        </div>

        <div style="margin-top:20px; display:flex; flex-direction:column; gap:8px;">
            <button onclick="nuevaRonda()">Jugar otra vez (Mismos jugadores)</button>
            <button class="ghost" onclick="mostrarSeccion('admin')">Volver al men√∫</button>
        </div>
    </div>
    
    <div class="spacer"></div>

    <footer class="footer">
        Development by VNGAS
    </footer>

</div>

<script>
    /* -------------------------------------------
       EFECTO M√ÅQUINA DE ESCRIBIR
    ------------------------------------------- */
    const titleElement = document.querySelector('h1');
    const textToType = "El Impostor";
    let charIndex = 0;

    function typeWriter() {
        if (charIndex < textToType.length) {
            titleElement.textContent += textToType.charAt(charIndex);
            charIndex++;
            setTimeout(typeWriter, 120); // Velocidad escritura
        }
    }
    setTimeout(typeWriter, 300);


    /* -------------------------------------------
       L√ìGICA DEL JUEGO
    ------------------------------------------- */
    let palabras = [];
    let jugadores = [];
    let jugadoresMezclados = [];
    let impostor = null;
    let palabraSeleccionada = "";
    let indiceActual = 0;
    let votos = {};
    let duracion = 60; 
    let timer = null;
    let tiempoRestante = 0;
    let timerRunning = false;

    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.classList.add('dark');
    }

    function toggleDarkMode(){
        document.documentElement.classList.toggle('dark');
    }

    function mostrarSeccion(id) {
        const secciones = ['admin','asignacion','pistas','votacion','resultado'];
        secciones.forEach(s => document.getElementById(s).style.display = (s===id ? 'block' : 'none'));
    }

    /* --- GESTI√ìN DE PALABRAS --- */
    function agregarPalabra(){
        const input = document.getElementById('nuevaPalabra');
        const p = input.value.trim();
        if(!p) return;
        palabras.push(p);
        renderPalabras();
        input.value = '';
        input.focus();
    }

    function eliminarPalabra(index){
        palabras.splice(index, 1);
        renderPalabras();
    }

    function editarPalabra(index){
        const actual = palabras[index];
        const nuevo = prompt("Corregir palabra:", actual);
        if(nuevo !== null && nuevo.trim() !== ""){
            palabras[index] = nuevo.trim();
            renderPalabras();
        }
    }

    function resetWords(){
        if(confirm("¬øBorrar todas las palabras?")) {
            palabras = [];
            renderPalabras();
        }
    }

    function renderPalabras(){
        const ul = document.getElementById('listaPalabras');
        ul.innerHTML = '';
        if(palabras.length === 0) {
            ul.innerHTML = '<li style="justify-content:center; color:var(--text-muted); font-style:italic">No hay palabras</li>';
        }
        palabras.forEach((p, index) => {
            const li = document.createElement('li');
            li.innerHTML = `
                <span>${p}</span>
                <div class="actions">
                    <button class="btn-icon btn-edit" onclick="editarPalabra(${index})">‚úé</button>
                    <button class="btn-icon btn-delete" onclick="eliminarPalabra(${index})">&times;</button>
                </div>
            `;
            ul.appendChild(li);
        });
    }

    /* --- GESTI√ìN DE JUGADORES --- */
    function agregarJugador(){
        const input = document.getElementById('nombreJugador');
        const name = input.value.trim();
        if(!name) return;
        jugadores.push(name);
        renderJugadores();
        input.value = '';
        input.focus();
    }

    function eliminarJugador(index){
        jugadores.splice(index, 1);
        renderJugadores();
    }

    function editarJugador(index){
        const actual = jugadores[index];
        const nuevo = prompt("Corregir nombre:", actual);
        if(nuevo !== null && nuevo.trim() !== ""){
            jugadores[index] = nuevo.trim();
            renderJugadores();
        }
    }

    function renderJugadores(){
        const ul = document.getElementById('listaJugadores');
        ul.innerHTML = '';
        if(jugadores.length === 0) {
            ul.innerHTML = '<li style="justify-content:center; color:var(--text-muted); font-style:italic">No hay jugadores</li>';
        }
        jugadores.forEach((j, index) => {
            const li = document.createElement('li');
            li.innerHTML = `
                <span>${j}</span>
                <div class="actions">
                    <button class="btn-icon btn-edit" onclick="editarJugador(${index})">‚úé</button>
                    <button class="btn-icon btn-delete" onclick="eliminarJugador(${index})">&times;</button>
                </div>
            `;
            ul.appendChild(li);
        });
    }

    /* --- RESTO DE LA L√ìGICA --- */
    function reiniciarTodo(){
        if(!confirm('¬øSeguro que quieres borrar jugadores y palabras?')) return;
        palabras = [];
        jugadores = [];
        resetGameData();
        renderPalabras();
        renderJugadores();
        mostrarSeccion('admin');
    }

    function resetGameData() {
        jugadoresMezclados = [];
        impostor = null;
        palabraSeleccionada = '';
        votos = {};
        stopTemporizador();
    }

    function iniciarJuego(){
        if(jugadores.length < 3){
            alert('Se recomiendan al menos 3 jugadores.');
        }
        if(palabras.length === 0){
            alert('A√±ade al menos una palabra para jugar.');
            return;
        }

        duracion = Number(document.getElementById('duracionSelect').value || 60);
        document.getElementById('duracionLabel').innerText = duracion + 's';

        nuevaRonda();
    }

    function nuevaRonda(){
        votos = {};
        document.getElementById('listaVotos').innerHTML = '';
        document.getElementById('noVotosMsg').style.display = 'block';
        document.getElementById('guessFeedback').innerText = '';
        document.getElementById('guessInput').value = '';
        document.getElementById('impostorGuessSection').style.display = 'none';

        palabraSeleccionada = palabras[Math.floor(Math.random()*palabras.length)];
        jugadoresMezclados = [...jugadores].sort(()=>Math.random()-0.5);
        impostor = jugadoresMezclados[Math.floor(Math.random()*jugadoresMezclados.length)];

        indiceActual = 0;
        document.getElementById('totalAsignacion').innerText = jugadoresMezclados.length;
        cargarJugador();
        mostrarSeccion('asignacion');

        stopTemporizador();
        tiempoRestante = duracion;
        actualizarTimerUI(duracion);
    }

    function cargarJugador(){
        const jugador = jugadoresMezclados[indiceActual];
        document.getElementById('nombreJugadorAsignacion').innerText = jugador;
        document.getElementById('indiceAsignacion').innerText = (indiceActual+1);
        
        const elem = document.getElementById('textoPalabra');
        elem.style.display = 'none';
        elem.classList.remove('neon');
    }

    function siguienteJugador(){
        document.getElementById('textoPalabra').style.display = 'none';
        
        indiceActual++;
        if(indiceActual >= jugadoresMezclados.length){
            document.getElementById('botonIniciarTimer').innerText = "‚ñ∂ Iniciar Temporizador";
            prepararVotacion();
            mostrarSeccion('pistas');
            return;
        }
        cargarJugador();
    }

    /* --- HOLD TO REVEAL --- */
    const btnReveal = document.getElementById('btnReveal');
    const revealBox = document.getElementById('textoPalabra');

    function showContent(){
        const jugador = jugadoresMezclados[indiceActual];
        if(jugador === impostor){
            revealBox.innerHTML = '<div style="color:#ff6b6b; font-size:24px; margin-bottom:5px">ü§´ IMPOSTOR</div><div style="font-size:14px; color:#ccc; font-weight:400">Enga√±a a los dem√°s</div>';
            revealBox.classList.remove('neon');
        } else {
            revealBox.innerHTML = `<div style="font-size:14px; color:#ccc; font-weight:400; margin-bottom:5px">La palabra es:</div><div style="font-size:24px">${palabraSeleccionada}</div>`;
            revealBox.classList.add('neon');
        }
        revealBox.style.display = 'flex';
        btnReveal.style.opacity = '0.5';
    }

    function hideContent(){
        revealBox.style.display = 'none';
        btnReveal.style.opacity = '1';
    }

    btnReveal.addEventListener('mousedown', showContent);
    btnReveal.addEventListener('mouseup', hideContent);
    btnReveal.addEventListener('mouseleave', hideContent);

    btnReveal.addEventListener('touchstart', (e) => {
        e.preventDefault(); 
        showContent();
    });
    btnReveal.addEventListener('touchend', hideContent);

    /* TEMPORIZADOR */
    function iniciarTemporizador(){
        if(timerRunning) {
            stopTemporizador();
            document.getElementById('botonIniciarTimer').innerText = "‚ñ∂ Reanudar";
            return;
        }
        
        if(tiempoRestante <= 0 && !timer) tiempoRestante = duracion;
        
        actualizarTimerUI(tiempoRestante);
        document.getElementById('botonIniciarTimer').innerText = 'Pausar';
        timerRunning = true;

        timer = setInterval(()=> {
            tiempoRestante -= 0.1; 
            if(tiempoRestante <= 0){
                tiempoRestante = 0;
                actualizarTimerUI(0);
                stopTemporizador();
                if(navigator.vibrate) navigator.vibrate([200, 100, 200]);
                alert("¬°Tiempo terminado!");
                saltarAPuesta();
            } else {
                actualizarTimerUI(tiempoRestante);
            }
        }, 100);
    }

    function stopTemporizador(){
        if(timer) clearInterval(timer);
        timer = null;
        timerRunning = false;
    }

    function actualizarTimerUI(segundos){
        document.getElementById('timerNumber').innerText = Math.ceil(segundos);
        const pct = Math.max(0, Math.min(1, segundos / duracion));
        document.getElementById('timerBar').style.width = (pct*100) + '%';
        
        const bar = document.getElementById('timerBar');
        if(pct < 0.2) bar.style.background = 'var(--danger)';
        else bar.style.background = 'linear-gradient(90deg, var(--accent), var(--accent-2))';
    }

    function saltarAPuesta(){
        stopTemporizador();
        prepararVotacion();
        mostrarSeccion('votacion');
    }

    /* VOTACI√ìN */
    function prepararVotacion(){
        const sel = document.getElementById('voto');
        sel.innerHTML = '';
        jugadores.forEach(j => {
            const opt = document.createElement('option');
            opt.value = j;
            opt.textContent = j;
            sel.appendChild(opt);
        });
        document.getElementById('listaVotos').innerHTML = '';
        document.getElementById('noVotosMsg').style.display = 'block';
        votos = {};
    }

    function registrarVoto(){
        const elegido = document.getElementById('voto').value;
        if(!elegido) return;
        
        votos[elegido] = (votos[elegido] || 0) + 1;

        const li = document.createElement('li');
        li.className = 'vote-item';
        li.innerHTML = `<span>Un voto para <strong>${elegido}</strong></span>`;
        
        document.getElementById('noVotosMsg').style.display = 'none';
        document.getElementById('listaVotos').appendChild(li);
    }

    function mostrarResultado(){
        let masVotado = null;
        let max = -1;
        for(const k in votos){
            if(votos[k] > max){ max = votos[k]; masVotado = k; }
        }

        const res = document.getElementById('textoResultado');
        const guessSection = document.getElementById('impostorGuessSection');
        
        if(!masVotado){
            res.innerHTML = `Nadie fue expulsado.<br>El impostor era <span style="color:var(--danger)">${impostor}</span>.`;
            guessSection.style.display = 'none';
        } 
        else if(masVotado === impostor){
            res.innerHTML = `¬°Atraparon al Impostor! era <strong>${impostor}</strong>.`;
            guessSection.style.display = 'none';
        } 
        else {
            res.innerHTML = `Se equivocaron. Expulsaron a <strong>${masVotado}</strong>.<br>El impostor era <strong style="color:var(--danger)">${impostor}</strong>.`;
            guessSection.style.display = 'block';
        }
        
        mostrarSeccion('resultado');
    }

    function impostorAdivina(){
        const intento = document.getElementById('guessInput').value.trim();
        const feed = document.getElementById('guessFeedback');
        
        if(!intento){ feed.innerText = 'Escribe algo primero.'; return; }
        
        if(intento.toLowerCase() === palabraSeleccionada.toLowerCase()){
            feed.style.color = '#10b981';
            feed.innerText = '¬°INCRE√çBLE! El impostor acert√≥ la palabra secreta.';
        } else {
            feed.style.color = 'var(--danger)';
            feed.innerText = `Incorrecto. La palabra era "${palabraSeleccionada}".`;
        }
    }

    document.addEventListener('keydown', e => {
        if(e.key === 'Enter'){
            const f = document.activeElement;
            if(f.id === 'nuevaPalabra') agregarPalabra();
            if(f.id === 'nombreJugador') agregarJugador();
            if(f.id === 'guessInput') impostorAdivina();
        }
    });

    mostrarSeccion('admin');
    renderPalabras();
    renderJugadores();

</script>
</body>
</html>